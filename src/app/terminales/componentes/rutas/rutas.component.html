<div class="titulo-ruta">
  <label for="">Rutas</label>
</div>
<div class="ruta w-100 custom-scroll" style="box-shadow: 0px 3px 6px #00000029;">
  <div class="d-flex mx-0 table-container">
    <table class="table custom-scroll">
      <thead class="encabezado">
        <tr>
          <th style="width: 80px;"><span class="fs-14px">Id_Ruta</span></th>
          <th style="width: 200px;"><span class="fs-14px">Departamento de origen</span></th>
          <th style="width: 200px;"><span class="fs-14px">Municipio de origen</span></th>
          <th style="width: 200px;"><span class="fs-14px">Centro poblado de origen</span></th>
          <th style="width: 200px;"><span class="fs-14px">Departamento de destino</span></th>
          <th style="width: 200px;"><span class="fs-14px">Municipio de destino</span></th>
          <th style="width: 200px;"><span class="fs-14px">Centro poblado de destino</span></th>
          <th style="width: 200px;"><span class="fs-14px">Tipo de llegada</span></th>
          <th style="width: 200px;"><span class="fs-14px">Dirección</span></th>
          <th style="width: 200px;"><span class="fs-14px">Vía</span></th>
          <th style="width: 200px;"><span class="fs-14px">¿La ruta está activa?</span></th>
          <th style="width: 200px;"><span class="fs-14px">N° de resolución en BD</span></th>
          <th style="width: 200px;"><span class="fs-14px">¿N° de Resolución corresponde?</span></th>
          <th style="width: 200px;"><span class="fs-14px">N° de resolución actual</span></th>
          <th style="width: 200px;"><span class="fs-14px">Dirección territorial</span></th>
          <th style="width: 250px;"><span class="fs-14px">Cargue su PDF</span></th>
          <th style="width: 200px;" *ngIf="verificacionVisible">
            <span class="fs-14px">Funciona</span>
          </th>
          <th style="width: 60px;" *ngIf="!verificacionVisible"></th>
          <th style="width: 60px;" *ngIf="!verificacionVisible"></th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let ruta of rutas; let i = index" [class.selected]="i === rutaSeleccionada" class="fila">
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.id_ruta}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.municipio_origen}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.departamento_origen}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.centro_poblado_origen}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.departamento_destino}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.municipio_destino}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.centro_poblado_destino}}
          </td>
          <td><!-- SELECT TIPO DE LLEGADA -->
            <select [(ngModel)]="ruta.tipo_llegada" name="tipo_llegada_{{i}}" class="form-select" (change)="maestraDireccion(ruta.tipo_llegada, i, 1)">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of tipoLlegada" [value]='opt.id'>{{opt.descripcion}}</option>
            </select>
          </td>
          <td><!-- SELECT DIRECCIONES -->
            <select [(ngModel)]="ruta.direccion" name="direccion_{{i}}" class="form-select"
            (change)="manejarCambios()" [disabled]="ruta.tipo_llegada === null">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let direccion of ruta.direcciones" [value]='direccion.id'>{{direccion.descripcion}}</option>
            </select>
          </td>
          <td style="width: 130px;">
            <input [(ngModel)]="ruta.via" name="via_{{i}}" type="text" class="form-control" (change)="manejarCambios()">
          </td>
          <td>
            <select [(ngModel)]="ruta.ruta_activa" name="ruta_activa_{{i}}" class="form-select" (change)="manejarCambios()">
              <option [value]='null'>Seleccione una opción</option>
              <option [value]='1'>Si</option>
              <option [value]='2'>No</option>
            </select>
          </td>
          <td>{{ruta.n_resolucion_bd}}</td>
          <td>
            <select [(ngModel)]="ruta.resolucion_corresponde" name="resolucion_corresponde_{{i}}" class="form-select" type="number"
            (change)="corresponde(ruta.resolucion_corresponde,i,ruta.id_ruta)" [disabled]="ruta.ruta_activa === 'null' || ruta.ruta_activa === '2'">
              <option [value]='null'>Seleccione una opción</option>
              <option [value]='1'>Si</option>
              <option [value]='2'>No</option>
            </select>
          </td>
          <td>
            <input [(ngModel)]="ruta.n_resolucion_actual" name="n_resolucion_actual_{{i}}" type="text" class="form-control"
            [disabled]="ruta.resolucion_corresponde === null || ruta.resolucion_corresponde === 1">
          </td>
          <td>{{ruta.dir_territorial}}</td>
          <td>
            <!-- <input [(ngModel)]="ruta.pdf" name="pdf_{{i}}" type="file" class="form-control"
            [disabled]="ruta.resolucion_corresponde === null || ruta.resolucion_corresponde === 1"> -->
            <label class="input-archivo d-flex" [for]="ruta.id_ruta" [ngClass]="{'disabled': ruta.resolucion_corresponde === null || ruta.resolucion_corresponde === 1 || !editable}">
              <div class="boton-adjuntar d-flex align-items-center justify-content-center">Seleccionar archivo</div>
              <div class="archivos">
                <div class=" d-flex" *ngIf="ruta.nombreOriginal">
                  <span class="nombre-archivo">{{ ruta.nombreOriginal }}</span>
                  <button class="eliminar-archivo" (click)="manejarRemoverArchivo(input,$event,1,i)"
                  [disabled]="ruta.resolucion_corresponde === null || ruta.resolucion_corresponde === 1 || !editable"><i class="bi bi-trash"></i></button>
                </div>
                <div class="sin-archivo d-flex" *ngIf="!ruta.nombreOriginal || ruta.nombreOriginal == null || ruta.nombreOriginal == ''">
                  <span>Sin archivo seleccionado</span>
                </div>
              </div>
              <input #input type="file" [id]="ruta.id_ruta" name="adjuntar" accept=".pdf"
              (change)="guardarArchivo($event,i,1,5)" [disabled]="ruta.resolucion_corresponde === null || ruta.resolucion_corresponde === 1 || !editable">
            </label>
          </td>
          <td *ngIf="verificacionVisible">
            <input type="checkbox">
          </td>
          <td *ngIf="!verificacionVisible"></td>
          <td *ngIf="!verificacionVisible"></td>
          <!-- <td>
            <button (click)="eliminarRuta(i)" type="button" class="btn btn-danger"><i class="bi bi-trash-fill"></i></button>
          </td> -->
        </tr>
        <!-- ///////////// BOTÓN PARA HABILITAR EL AGREGAR NUEVA RUTA -->
        <tr *ngIf="!verificacionVisible">
          <td colspan="18">
            <button type="button" class="boton primario relleno" (click)="estadoAgregarRuta(true)">
              Agregar ruta <i class="bi bi-plus-circle"></i>
            </button>
          </td>
        </tr>
        <!-- //////////// AGREGAR NUEVA RUTA ///////////////////// -->
        <tr *ngIf="!verificacionVisible && rutaNuevaHabilitada"><!--  -->
          <td><input [(ngModel)]="rutaNueva.id_ruta" type="text" name="id_ruta" id="" class="form-control"></td>
          <td>
            <!-- SELECT DEPARTAMENTOS ORIGEN -->
            <select id="dep origen" class="form-select" (change)="maestraMunicipios($event,'mun origen',1)">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of departamentos" [value]='opt.codigoDepartamento'>{{opt.nombre}}</option>
            </select>
          </td>
          <td>
            <!-- SELECT MUNICIPIOS ORIGEN -->
            <select id="mun origen" class="form-select" (change)="maestraCP($event,'cp origen',1)" disabled>
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of municipiosOrigen" [value]='opt.codigoMunicipio'>{{opt.nombre}}</option>
            </select>
          </td>
          <td>
            <!-- SELECT CENTROS POBLADOR ORIGEN -->
            <select id="cp origen" class="form-select" disabled>
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of centroPobladoOrigen" [value]='opt.codigoMunicipio'>{{opt.nombre}}</option>
            </select>
          </td>
          <td>
            <!-- SELECT DEPARTAMENTOS DESTINO -->
            <select id="dep destino" class="form-select" (change)="maestraMunicipios($event,'mun destino',2)">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of departamentos" [value]='opt.codigoDepartamento'>{{opt.nombre}}</option>
            </select>
          </td>
          <td><!-- SELECT MUNICIPIOS DESTINO -->
            <select id="mun destino" class="form-select" (change)="maestraCP($event,'cp destino',2)" disabled>
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of municipiosDestino" [value]='opt.codigoMunicipio'>{{opt.nombre}}</option>
            </select>
          </td>
          <td><!-- SELECT CENTROS POBLADOR DESTINO -->
            <select id="cp destino" class="form-select" disabled>
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of centroPobladoDestino" [value]='opt.codigoMunicipio'>{{opt.nombre}}</option>
            </select>
          </td>
          <td><!-- SELECT TIPO DE LLEGADA -->
            <select [(ngModel)]="rutaNueva.tipo_llegada" name="tipo_llegada" class="form-select" (change)="maestraDireccion(rutaNueva.tipo_llegada,undefined,2)">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of tipoLlegada" [value]='opt.id'>{{opt.descripcion}}</option>
            </select>
          </td>
          <td><!-- SELECT DIRECCIONES -->
            <select [(ngModel)]="rutaNueva.direccion" name="direccion" class="form-select" [disabled]="rutaNueva.tipo_llegada === null">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let direccion of direcciones" [value]='direccion.id'>{{direccion.descripcion}}</option>
            </select>
          </td>
          <td style="width: 130px;">
            <input [(ngModel)]="rutaNueva.via" name="via" type="text" class="form-control">
          </td>
          <td>
            <select [(ngModel)]="rutaNueva.ruta_activa" name="ruta_activa" class="form-select">
              <option [value]='null'>Seleccione una opción</option>
              <option value='1'>Si</option>
              <option value='2'>No</option>
            </select>
          </td>
          <td><input [(ngModel)]="rutaNueva.n_resolucion_bd" type="text" name="num BD" id="" class="form-control"></td>
          <td>
            <select [(ngModel)]="rutaNueva.resolucion_corresponde" name="resolucion_corresponde" class="form-select" type="number"
              [disabled]="rutaNueva.ruta_activa === null || rutaNueva.ruta_activa === '2'">
              <option [value]='null'>Seleccione una opción</option>
              <option [value]='1'>Si</option>
              <option [value]='2'>No</option>
            </select>
          </td>
          <td>
            <input [(ngModel)]="rutaNueva.n_resolucion_actual" name="n_resolucion_actual" type="number" class="form-control"
            [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1">
          </td>
          <td>
            <input [(ngModel)]="rutaNueva.dir_territorial" type="text" name="dir_territorial" id="" class="form-control" >
          </td>
          <td>
            <!-- <input [(ngModel)]="rutaNueva.pdf" name="pdf" type="file" class="form-control"
            [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1"> -->
            <label class="input-archivo d-flex" for="adjuntar"
            [ngClass]="{'disabled':rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1 || !editable}">
              <div class="boton-adjuntar d-flex align-items-center justify-content-center">Seleccionar archivo</div>
              <div class="archivos">
                <div class="archivo d-flex" *ngIf="rutaNueva.nombreOriginal">
                  <span class="nombre-archivo">{{ rutaNueva.nombreOriginal }}</span>
                  <button class="eliminar-archivo" (click)="manejarRemoverArchivo(input,$event,2)"
                  [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1 || !editable"><i class="bi bi-trash"></i></button>
                </div>
                <div class="sin-archivo d-flex" *ngIf="!rutaNueva.nombreOriginal || rutaNueva.nombreOriginal == null || rutaNueva.nombreOriginal == ''">
                  <span>Sin archivo seleccionado</span>
                </div>
              </div>
              <input #input type="file" id="adjuntar" name="adjuntar" accept=".pdf"
              (change)="guardarArchivo($event,undefined,2,5)" [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1 || !editable">
            </label>
          </td>
          <td>
            <button (click)="agregarRuta()" type="button" class="eliminar-ruta fw-semibold"><i class="bi bi-floppy"></i></button>
          </td>
          <td>
            <button (click)="estadoAgregarRuta(false)" type="button" class="eliminar-ruta fw-semibold"><i class="bi bi-trash"></i></button>
          </td>
        </tr>
      </tbody>
      <!-- <tfoot>
        <tr style="margin-top: 10px; margin-left: 10px;">
          <td colspan="14"><button type="button" class="boton primario relleno">Agregar ruta <i class="bi bi-plus-circle"></i></button></td>
        </tr>
      </tfoot> -->
    </table>
  </div>
</div>
<hr>
<div *ngIf="rutaConsultada" style="margin-bottom: 10px;">
  <app-paradas
  (paradasGuardar)="recibirParadas($event)"
  ></app-paradas>
</div>
<div *ngIf="rutaConsultada" style="margin-bottom: 10px;">
  <app-clases></app-clases>
</div>
