<div class="titulo-ruta">
  <label for="">Rutas</label>
</div>
<div class="ruta w-100 custom-scroll">
  <div class="d-flex mx-0 table-container">
    <table class="table custom-scroll">
      <thead class="encabezado">
        <tr>
          <th style="width: 100px;"><span class="fs-14px">Id_Ruta</span></th>
          <th style="width: 200px;"><span class="fs-14px">Departamento de origen</span></th>
          <th style="width: 200px;"><span class="fs-14px">Municipio de origen</span></th>
          <th style="width: 200px;"><span class="fs-14px">Centro poblado de origen</span></th>
          <th style="width: 200px;"><span class="fs-14px">Departamento de destino</span></th>
          <th style="width: 200px;"><span class="fs-14px">Municipio de destino</span></th>
          <th style="width: 200px;"><span class="fs-14px">Centro poblado de destino</span></th>
          <th style="width: 200px;"><span class="fs-14px">Tipo de llegada</span></th>
          <th style="width: 200px;"><span class="fs-14px">Dirección</span></th>
          <th style="width: 200px;"><span class="fs-14px">Vía</span></th>
          <th style="width: 200px;"><span class="fs-14px">¿La ruta está activa?</span></th>
          <th style="width: 200px;"><span class="fs-14px">N° de resolución en BD</span></th>
          <th style="width: 200px;"><span class="fs-14px">¿N° de Resolución corresponde?</span></th>
          <th style="width: 200px;"><span class="fs-14px">N° de resolución actual</span></th>
          <th style="width: 200px;"><span class="fs-14px">Dirección territorial</span></th>
          <th style="width: 250px;"><span class="fs-14px">Cargue su PDF</span></th>
          <th style="width: 200px;" *ngIf="verificacionVisible">
            <span class="fs-14px">Funciona</span>
          </th>
          <th style="width: 60px;" *ngIf="!verificacionVisible"></th>
          <th style="width: 60px;" *ngIf="!verificacionVisible"></th>
        </tr>
      </thead>
      <tbody>
        <tr class="fila" *ngFor="let ruta of rutas | paginate: { itemsPerPage: 5, currentPage: page }; let i = index"
          [class.selected]="i === rutaSeleccionada">
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.id_unico_ruta}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.departamento_origen}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.municipio_origen}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.cp_origen}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.departamento_destino}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.municipio_destino}}
          </td>
          <td (click)="seleccionarRuta(ruta, i)">
            {{ruta.cp_destino}}
          </td>
          <td><!-- SELECT TIPO DE LLEGADA -->
            <select [(ngModel)]="ruta.tipo_llegada_id" name="tipo_llegada_{{i}}" class="form-select"
              [class.marcar-error]="!ruta.tipo_llegada_id && errorRutas"
              (change)="maestraDireccion(ruta.tipo_llegada_id,ruta.cp_destino_codigo, i, true)">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of tipoLlegada" [value]='opt.id'>{{opt.descripcion}}</option>
            </select>
          </td>
          <td><!-- SELECT DIRECCIONES -->
            <select [(ngModel)]="ruta.direccion_id" name="direccion_{{i}}" class="form-select"
              (change)="manejarDirecciones($event,ruta.tipo_llegada_id,ruta.cp_destino_codigo,i)"
              [disabled]="ruta.tipo_llegada_id === null">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let direccion of ruta.direcciones" [value]='direccion.id'>{{direccion.descripcion}}
              </option>
              <option value="abrirModal">Añadir nueva dirección</option> <!-- Opción para abrir el modal -->
            </select>
          </td>
          <td style="width: 130px;">
            <input [(ngModel)]="ruta.via" name="via_{{i}}" type="text" class="form-control" (change)="manejarCambios()"
              placeholder="-">
          </td>
          <td>
            <select [(ngModel)]="ruta.estado" name="ruta_activa_{{i}}" class="form-select"
              (change)="estadoRuta(ruta.estado,i)">
              <option [value]='null'>Seleccione una opción</option>
              <option [value]='true'>Si</option>
              <option [value]='false'>No</option>
            </select>
          </td>
          <td>{{ruta.resolucion}}</td>
          <td>
            <select [(ngModel)]="ruta.corresponde" name="resolucion_corresponde_{{i}}" class="form-select" type="number"
              (change)="corresponde(ruta.corresponde,i,ruta.id_ruta)" [disabled]="!ruta.estado">
              <option [value]='null'>Seleccione una opción</option>
              <option [value]='1'>Si</option>
              <option [value]='2'>No</option>
            </select>
          </td>
          <td>
            <input [(ngModel)]="ruta.resolucion_actual" name="n_resolucion_actual_{{i}}" type="text"
              class="form-control" [disabled]="ruta.corresponde === null || ruta.corresponde === 1"
              placeholder="-">
          </td>
          <td>{{ruta.direccion_territorial}}</td>
          <td>
            <!-- <input [(ngModel)]="ruta.pdf" name="pdf_{{i}}" type="file" class="form-control"
            [disabled]="ruta.resolucion_corresponde === null || ruta.resolucion_corresponde === 1"> -->
            <label class="input-archivo d-flex" [for]="'Archivo'+i"
              [ngClass]="{'disabled': ruta.corresponde === null || ruta.corresponde === 1 || !editable}">
              <div class="boton-adjuntar d-flex align-items-center justify-content-center">Seleccionar archivo</div>
              <div class="archivos">
                <div class=" d-flex" *ngIf="ruta.nombre_original">
                  <span class="nombre-archivo">{{ ruta.nombre_original }}</span>
                  <button class="eliminar-archivo" (click)="manejarRemoverArchivo(input,$event,1,i)"
                    [disabled]="ruta.corresponde === null || ruta.corresponde === 1 || !editable"><i
                      class="bi bi-trash"></i></button>
                </div>
                <div class="sin-archivo d-flex"
                  *ngIf="!ruta.nombre_original || ruta.nombre_original == null || ruta.nombre_original == ''">
                  <span>Sin archivo seleccionado</span>
                </div>
              </div>
              <input #input type="file" [id]="'Archivo'+i" name="adjuntar" accept=".pdf"
                (change)="guardarArchivo($event,i,1,5)"
                [disabled]="ruta.corresponde === null || ruta.corresponde === 1 || !editable">
            </label>
          </td>
          <td *ngIf="verificacionVisible">
            <input type="checkbox">
          </td>
          <td *ngIf="!verificacionVisible"></td>
          <td *ngIf="!verificacionVisible"></td>
          <!-- <td>
            <button (click)="eliminarRuta(i)" type="button" class="btn btn-danger"><i class="bi bi-trash-fill"></i></button>
          </td> -->
        </tr>
        <tr *ngIf="rutas.length <= 0">
          <td colspan="18">
            <h6 class="sin-registros"> -- No hay rutas para mostrar. --</h6>
          </td>
        </tr>
        <!-- ///////////// BOTÓN PARA HABILITAR EL AGREGAR NUEVA RUTA -->
        <tr *ngIf="!verificacionVisible">
          <td colspan="18">
            <button type="button" class="boton primario relleno" (click)="estadoAgregarRuta(true)">
              Agregar ruta <i class="bi bi-plus-circle"></i>
            </button>
          </td>
        </tr>
        <!-- //////////// AGREGAR NUEVA RUTA ///////////////////// -->
        <tr *ngIf="!verificacionVisible && rutaNuevaHabilitada"><!--  -->
          <td>
            <input type="text" name="id_ruta" id="" class="form-control"
               placeholder="-" [disabled]="true"><!-- [class.marcar-error]="!rutaNueva.id_ruta && error" -->
          </td>
          <td>
            <!-- SELECT DEPARTAMENTOS ORIGEN -->
            <select id="dep origen" class="form-select" (change)="maestraMunicipios($event,'mun origen',1)"
              [class.marcar-error]="validarCampo('dep origen') && error">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of departamentos" [value]='opt.codigoDepartamento'>{{opt.nombre}}</option>
            </select>
          </td>
          <td>
            <!-- SELECT MUNICIPIOS ORIGEN -->
            <select id="mun origen" class="form-select" (change)="maestraCP($event,'cp origen',1)" disabled
              [class.marcar-error]="validarCampo('mun origen') && error">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of municipiosOrigen" [value]='opt.codigoMunicipio'>{{opt.nombre}}</option>
            </select>
          </td>
          <td>
            <!-- SELECT CENTROS POBLADOR ORIGEN -->
            <select [(ngModel)]="rutaNueva.centro_poblado_origen" id="cp origen" class="form-select" disabled
              [class.marcar-error]="!rutaNueva.centro_poblado_origen && error">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of centroPobladoOrigen" [value]='opt.codigoCentroPoblado'>{{opt.nombre}}</option>
            </select>
          </td>
          <td>
            <!-- SELECT DEPARTAMENTOS DESTINO -->
            <select id="dep destino" class="form-select" (change)="maestraMunicipios($event,'mun destino',2)"
              [class.marcar-error]="validarCampo('dep destino') && error">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of departamentos" [value]='opt.codigoDepartamento'>{{opt.nombre}}</option>
            </select>
          </td>
          <td><!-- SELECT MUNICIPIOS DESTINO -->
            <select id="mun destino" class="form-select" (change)="maestraCP($event,'cp destino',2,true)" disabled
              [class.marcar-error]="validarCampo('mun destino') && error">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of municipiosDestino" [value]='opt.codigoMunicipio'>{{opt.nombre}}</option>
            </select>
          </td>
          <td><!-- SELECT CENTROS POBLADOR DESTINO -->
            <select [(ngModel)]="rutaNueva.centro_poblado_destino" id="cp destino" class="form-select" disabled
              [class.marcar-error]="!rutaNueva.centro_poblado_destino && error" (change)="manejarTipoLlegadaNueva()">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of centroPobladoDestino" [value]='opt.codigoCentroPoblado'>{{opt.nombre}}</option>
            </select>
          </td>
          <td><!-- SELECT TIPO DE LLEGADA -->
            <select [(ngModel)]="rutaNueva.tipo_llegada" name="tipo_llegada" class="form-select"
              (change)="maestraDireccion(rutaNueva.tipo_llegada,rutaNueva.centro_poblado_destino)"
              [class.marcar-error]="!rutaNueva.tipo_llegada && error"
              [disabled]="rutaNueva.centro_poblado_destino === 'null' || rutaNueva.centro_poblado_destino === null">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let opt of tipoLlegada" [value]='opt.id'>{{opt.descripcion}}</option>
            </select>
          </td>
          <td><!-- SELECT DIRECCIONES -->
            <select [(ngModel)]="rutaNueva.direccion" name="direccion" class="form-select"
              [disabled]="rutaNueva.tipo_llegada === null" [class.marcar-error]="!rutaNueva.direccion && error"
              (change)="manejarDirecciones($event,rutaNueva.tipo_llegada,rutaNueva.centro_poblado_destino)">
              <option [value]="null">Seleccione una opción</option>
              <option *ngFor="let direccion of direcciones" [value]='direccion.id'>{{direccion.descripcion}}</option>
              <option value="abrirModal">Añadir nueva dirección</option> <!-- Opción para abrir el modal -->
            </select>
          </td>
          <td style="width: 130px;"> <!-- INPUT VIA -->
            <input [(ngModel)]="rutaNueva.via" name="via" type="text" class="form-control"
              [class.marcar-error]="!rutaNueva.via && error" placeholder="Vía">
          </td>
          <td><!-- SELECT RUTA ACTIVA -->
            <select [(ngModel)]="rutaNueva.ruta_activa" name="ruta_activa" class="form-select"
              [class.marcar-error]="!rutaNueva.ruta_activa && error" (change)="estadoRuta(rutaNueva.ruta_activa,undefined)">
              <option [value]='null'>Seleccione una opción</option>
              <option [value]='true'>Si</option>
              <option [value]='false'>No</option>
            </select>
          </td>
          <td><!-- [class.marcar-error]="!rutaNueva.n_resolucion_bd && error" -->
            <input type="text" name="num BD" id="" class="form-control" [disabled]="true" placeholder="-">
          </td>
          <td>
            <!-- rutaNueva.ruta_activa === null || rutaNueva.ruta_activa === '2' // [class.marcar-error]="!rutaNueva.resolucion_corresponde && error"-->
            <select name="resolucion_corresponde" class="form-select" type="number" [disabled]="true">
              <option [value]='null'>-</option>
              <option [value]='1'>Si</option>
              <option [value]='2'>No</option>
            </select>
          </td>
          <td><!-- INPUT NUMERO RESOLUCION -->
            <!-- [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === '1'" -->
            <input [(ngModel)]="rutaNueva.n_resolucion_actual" name="n_resolucion_actual" type="number"
              class="form-control" [class.marcar-error]="!rutaNueva.n_resolucion_actual && error"
              placeholder="N° de la resolución">
          </td>
          <td><!-- INPUT DIRECCION TERRITORIAL -->
            <input [(ngModel)]="rutaNueva.dir_territorial" type="text" name="dir_territorial" id="" class="form-control"
              [class.marcar-error]="!rutaNueva.dir_territorial && error" placeholder="Dirección territorial">
          </td>
          <td><!-- INPUT ARCHIVO -->
            <!-- <input [(ngModel)]="rutaNueva.pdf" name="pdf" type="file" class="form-control"
            [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1"> // [ngClass]="{'disabled':rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === '1'}"-->
            <label [class.marcar-error]="!rutaNueva.nombreOriginal && error" class="input-archivo d-flex"
              for="adjuntar">
              <div class="boton-adjuntar d-flex align-items-center justify-content-center">Seleccionar archivo</div>
              <div class="archivos">
                <div class="archivo d-flex" *ngIf="rutaNueva.nombreOriginal">
                  <span class="nombre-archivo">{{ rutaNueva.nombreOriginal
                    }}</span><!-- [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1" -->
                  <button class="eliminar-archivo" (click)="manejarRemoverArchivo(input,$event,2)"><i
                      class="bi bi-trash"></i></button>
                </div>
                <div class="sin-archivo d-flex"
                  *ngIf="!rutaNueva.nombreOriginal || rutaNueva.nombreOriginal == null || rutaNueva.nombreOriginal == ''">
                  <span>Sin archivo seleccionado</span>
                </div>
              </div>
              <!-- [disabled]="rutaNueva.resolucion_corresponde === null || rutaNueva.resolucion_corresponde === 1" -->
              <input #input type="file" id="adjuntar" name="adjuntar" accept=".pdf"
                (change)="guardarArchivo($event,undefined,2,5)">
            </label>
          </td>
          <td>
            <button (click)="agregarRuta()" type="button" class="eliminar-ruta fw-semibold"><i
                class="bi bi-floppy"></i></button>
          </td>
          <td>
            <button (click)="estadoAgregarRuta(false)" type="button" class="eliminar-ruta fw-semibold"><i
                class="bi bi-trash"></i></button>
          </td>
        </tr>
      </tbody>
      <!-- <tfoot>
        <tr style="margin-top: 10px; margin-left: 10px;">
          <td colspan="14"><button type="button" class="boton primario relleno">Agregar ruta <i class="bi bi-plus-circle"></i></button></td>
        </tr>
      </tfoot> -->
    </table>
  </div>
  <div class="d-flex justify-content-end" style="margin-right: 20px;">
    <!-- Paginador -->
    <pagination-controls
      class="pagination-controls"
      (pageChange)="page = $event"
      previousLabel="Ant."
      nextLabel="Sig."
      [maxSize]="7"
      [directionLinks]="true"
      [autoHide]="false">
    </pagination-controls>
    <!--  <ngb-pagination [collectionSize]="paginadorReportes.totalRegistros ?? 0" [page]="paginadorReportes.pagina"
      [pageSize]="paginadorReportes.limite" (pageChange)="paginadorReportes.cambiarPagina($event)" [maxSize]="5">
      <ng-template ngbPaginationFirst>Prim.</ng-template>
      <ng-template ngbPaginationLast>Ult.</ng-template>
      <ng-template ngbPaginationPrevious>Ant.</ng-template>
      <ng-template ngbPaginationNext>Sig.</ng-template>
    </ngb-pagination> -->
  </div>
</div>
<hr>
<div *ngIf="rutaConsultada" style="margin-bottom: 10px;">
  <app-paradas (paradasGuardar)="recibirParadas($event)" [rutaId]="rutaId"></app-paradas>
</div>
<div *ngIf="rutaConsultada" style="margin-bottom: 10px;">
  <app-clases></app-clases>
</div>
